{# templates/offre/calendrier.html.twig #}
{% extends 'base2.html.twig' %}

{% block body %}
    <div id="calendar"></div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
    function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var events = '{{ events | raw }}'; 
    
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            events: JSON.parse(events).map(event => ({
                ...event,
                color: getRandomColor() // Assigner une couleur aléatoire à chaque événement
            })),
            editable: true,
            
            eventDrop: function(info) {
                var event = info.event;
            
                var data = {
                    id: event.id, // Assurez-vous que cet ID est correct
                    start: event.startStr,
                    end: event.endStr
                };
            
                // Assurez-vous que 'url' est défini avant son utilisation
                var url = '{{ path("update_offre_date") }}'; 
            
                fetch(url, {  // Utilisez la variable 'url'
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to update event dates');
                    }
                    return response.json();
                })
                .catch(error => {
                    console.error('Error during eventDrop:', error); // Afficher l'erreur dans la console
                });
            }
        });
    
        calendar.render(); 
    });
    
</script>
{% endblock %}

